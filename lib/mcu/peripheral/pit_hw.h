/**
 * @file HW_PIT.h
 * @version 3.0[By LPLD]
 * @date 2013-06-18
 * @brief PIT底层模块相关函数
 *
 * 更改建议:不建议修改
 *
 * 版权所有:北京拉普兰德电子技术有限公司
 * http://www.lpld.cn
 * mail:support@lpld.cn
 *
 * @par
 * 本代码由拉普兰德[LPLD]开发并维护，并向所有使用者开放源代码。
 * 开发者可以随意修使用或改源代码。但本段及以上注释应予以保留。
 * 不得更改或删除原版权所有者姓名，二次开发者可以加注二次版权所有者。
 * 但应在遵守此协议的基础上，开放源代码、不得出售代码本身。
 * 拉普兰德不负责由于使用本代码所带来的任何事故、法律责任或相关不良影响。
 * 拉普兰德无义务解释、说明本代码的具体原理、功能、实现方法。
 * 除非拉普兰德[LPLD]授权，开发者不得将本代码用于商业产品。
 */
#ifndef __HW_PIT_H__
#define __HW_PIT_H__
/********************************************************************/
#include "common.h"
#include "cpu.h"
//PIT模块中断回调函数类型
typedef void (*PIT_ISR_CALLBACK)(void);

//PIT模块号定义
typedef enum PITx
{
  PIT0=0,
  PIT1=1,
  PIT2=2,
  PIT3=3
}PITx;

//PIT模块初始化结构体，用于配置PIT各项参数
typedef struct
{  
  /*
    描述：
      选择PITx
    取值：
      PIT0、PIT1、PIT2、PIT3
    初始化：
      必须初始化
  */
  PITx PIT_Pitx;
  
  /*
    描述：
      PITx模块的周期，单位20us
    取值：
      1~0xFFFFFFFF
    初始化：
  */
  uint32 PIT_Period;
//  /*
//    描述：
//      PITx模块的周期，单位us
//    取值：
//      1~0xFFFFFFFF
//    初始化：
//      不必须初始化，PIT_PeriodUs、PIT_PeriodMs、PIT_PeriodS至少一个初始化
//  */
//  uint32 PIT_PeriodUs;
//  
//  /*
//    描述：
//      PITx模块的周期，单位ms
//    取值：
//      1~0xFFFFFFFF
//    初始化：
//      不必须初始化，PIT_PeriodUs、PIT_PeriodMs、PIT_PeriodS至少一个初始化
//  */
//  uint32 PIT_PeriodMs;
  
//  /*
//    描述：
//      PITx模块的周期，单位s
//    取值：
//      1~0xFFFFFFFF
//    初始化：
//      不必须初始化，PIT_PeriodUs、PIT_PeriodMs、PIT_PeriodS至少一个初始化
//  */
//  uint32 PIT_PeriodS;

  /*
    描述：
      PITx中断回调函数
    取值：
      函数必须为无返回值,无参数(eg. void isr(void);)
      当为NULL时，表示不开始中断
    初始化：
      不必须初始化、如未初始化则不会触发中断
  */
  PIT_ISR_CALLBACK PIT_Isr; 
} PIT_InitTypeDef;
// 获取当前计数值
//#define LPLD_PIT_GetValue (pitx)    PIT_CVAL(pitx)
inline uint32 LPLD_PIT_GetValue (uint32 pitx) {return PIT_CVAL(pitx);}
// 判断是否超时
//#define LPLD_PIT_IfTimeout(pitx)    (PIT_TFLG(pitx)&0x01)
inline uint32 LPLD_PIT_IfTimeout (uint32 pitx) {return (PIT_TFLG(pitx)&0x01);}
// 启动计数
//#define LPLD_PIT_Start(pitx)        do{PIT_TCTRL(pitx) |= PIT_TCTRL_TEN_MASK;}while(0)
inline void LPLD_PIT_Start (uint32 pitx) {PIT_TCTRL(pitx) |= PIT_TCTRL_TEN_MASK;}
// 关闭计数
//#define LPLD_PIT_Stop(pitx)         do{PIT_TCTRL(pitx) &= PIT_TCTRL_TEN_MASK;}while(0)
inline void LPLD_PIT_Stop (uint32 pitx) {PIT_TCTRL(pitx) &= PIT_TCTRL_TEN_MASK;}
    
// 重新启动计数
uint32 LPLD_PIT_Restart(PIT_InitTypeDef *pit_init_structure);
//#define LPLD_PIT_Restart(pitx,cnt)   do{\
//    PIT_TCTRL(pitx) &= ~PIT_TCTRL_TEN_MASK;\
//    PIT_LDVAL(pitx) = cnt;\
//    PIT_TFLG(pitx) |= PIT_TFLG_TIF_MASK;\
//    PIT_TCTRL(pitx) |= PIT_TCTRL_TEN_MASK;\
//\}while(0)



//PIT通用初始化函数，选择PITx、配置中断周期、中断函数
uint8 LPLD_PIT_Init(PIT_InitTypeDef *pit_init_structure);
//PIT反初始化函数，关闭选择的PITx
void LPLD_PIT_Deinit(PIT_InitTypeDef *pit_init_structure);
//使能PITx中断
void LPLD_PIT_Enable(PIT_InitTypeDef *pit_init_structure);
//禁用PITx中断
void LPLD_PIT_Disable(PIT_InitTypeDef *pit_init_structure);
int LPLD_PIT_Delay (uint32 pitx, uint32 cnt);
void PIT0_IRQHandler(void);

#endif /* __HW_PIT_H__ */
